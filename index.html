<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrenamiento Dual de Modelos GAD - Completo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            gap: 20px;
        }
        
        .step-dot {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 18px;
        }
        
        .step-dot.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.2);
        }
        
        .step-dot.completed {
            background: #27ae60;
            color: white;
        }
        
        .step-content {
            display: none;
        }
        
        .step-content.active {
            display: block;
        }
        
        .step-title {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #27ae60;
            margin-bottom: 30px;
        }
        
        .step-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .step-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #667eea;
            transition: transform 0.3s ease;
        }
        
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .chart-container {
            position: relative;
            height: 500px;
            margin: 20px 0;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .formula {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            text-align: center;
            font-size: 14px;
        }
        
        .gad-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .gad-btn {
            padding: 10px 20px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .gad-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .result-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .result-card:hover {
            transform: scale(1.05);
        }
        
        .result-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 15px 0;
        }
        
        .problem-section {
            background: linear-gradient(135deg, #ff7675, #fd79a8);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        
        .value-card {
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            color: white;
            font-weight: bold;
        }
        
        .real-value { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .model-value { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .difference-value { background: linear-gradient(135deg, #f39c12, #d35400); }
        
        .value-amount {
            font-size: 2.2em;
            margin: 15px 0;
        }
        
        .factor-section {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }
        
        .factor-formula {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            text-align: center;
            font-size: 1.3em;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .factor-result {
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            margin: 25px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .steps-process {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .process-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #667eea;
            transition: transform 0.3s ease;
        }
        
        .process-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .process-number {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .solution-section {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }
        
        .interpretation-box {
            background: #e8f4f8;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border-left: 5px solid #17a2b8;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-3px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .step-grid, .comparison-grid, .steps-process {
                grid-template-columns: 1fr;
            }
            .container { padding: 20px; }
            .step-indicator { gap: 10px; }
            .step-dot { width: 40px; height: 40px; font-size: 16px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è Entrenamiento Dual de Modelos GAD</h1>
            <p style="color: #6c757d; font-size: 1.2em;">De la Teor√≠a a la Aplicaci√≥n Pr√°ctica</p>
        </div>

        <div class="step-indicator">
            <div class="step-dot completed" data-step="1">1</div>
            <div class="step-dot" data-step="2">2</div>
            <div class="step-dot" data-step="3">3</div>
            <div class="step-dot" data-step="4">4</div>
            <div class="step-dot" data-step="5">5</div>
        </div>

        <!-- Paso 1: Datos Iniciales -->
        <div class="step-content active" data-step="1">
            <div class="step-title">
                <h2>üìä Paso 1: Datos Hist√≥ricos (2018-2024)</h2>
                <p>Datos reales de ingresos de diferentes GADs con heterogeneidad observada</p>
            </div>
            
            <div class="step-grid">
                <div class="step-card">
                    <h3>Heterogeneidad Observada</h3>
                    <ul>
                        <li><strong>GAD Urbano:</strong> Alto rendimiento (+20%)</li>
                        <li><strong>GAD Rural:</strong> Rendimiento bajo (-15%)</li>
                        <li><strong>GAD Tur√≠stico:</strong> Alta variabilidad</li>
                    </ul>
                </div>
                <div class="step-card">
                    <h3>Objetivo del An√°lisis</h3>
                    <p>Separar el comportamiento com√∫n de las caracter√≠sticas espec√≠ficas.</p>
                    <div class="formula">
                        Ingreso_GAD = Comportamiento_Com√∫n + Efecto_Espec√≠fico
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="chart1"></canvas>
            </div>
        </div>

        <!-- Paso 2: Modelo Completo -->
        <div class="step-content" data-step="2">
            <div class="step-title">
                <h2>üß† Paso 2: Modelo Completo (CON efectos GAD)</h2>
                <p>Captura el comportamiento espec√≠fico de cada GAD</p>
            </div>
            
            <div class="formula">
                ln(Ingreso) = Œ≤‚ÇÄ + Œ≤‚ÇÅ¬∑lag1 + Œ≤‚ÇÇ¬∑lag2 + Œ≤‚ÇÉ¬∑lag3 + Œ±_GAD + Œµ
            </div>
            
            <div class="chart-container">
                <canvas id="chart2"></canvas>
            </div>
        </div>

        <!-- Paso 3: Modelo Base -->
        <div class="step-content" data-step="3">
            <div class="step-title">
                <h2>üìè Paso 3: Modelo Base (SIN efectos GAD)</h2>
                <p>L√≠nea base neutral com√∫n a todos los GADs</p>
            </div>
            
            <div class="formula">
                ln(Ingreso) = Œ≤‚ÇÄ + Œ≤‚ÇÅ¬∑lag1 + Œ≤‚ÇÇ¬∑lag2 + Œ≤‚ÇÉ¬∑lag3 + Œµ
            </div>
            
            <div class="chart-container">
                <canvas id="chart3"></canvas>
            </div>
        </div>

        <!-- Paso 4: Factor de Correcci√≥n Te√≥rico -->
        <div class="step-content" data-step="4">
            <div class="step-title">
                <h2>‚öñÔ∏è Paso 4: Factor de Correcci√≥n (Ejemplos Te√≥ricos)</h2>
                <p>C√°lculo del factor para diferentes tipos de GAD</p>
            </div>
            
            <div class="gad-selector">
                <button class="gad-btn active" onclick="selectGAD('urbano')">GAD Urbano</button>
                <button class="gad-btn" onclick="selectGAD('rural')">GAD Rural</button>
                <button class="gad-btn" onclick="selectGAD('turistico')">GAD Tur√≠stico</button>
            </div>
            
            <div class="chart-container">
                <canvas id="chart4"></canvas>
            </div>
            
            <div class="results-grid">
                <div class="result-card">
                    <div>Factor Promedio</div>
                    <div class="result-value" id="factorDisplay">1.20</div>
                    <div id="gadNameDisplay">GAD Urbano</div>
                </div>
                <div class="result-card">
                    <div>Interpretaci√≥n</div>
                    <div class="result-value" id="percentageDisplay">+20%</div>
                    <div>Sobre promedio</div>
                </div>
            </div>
        </div>

        <!-- Paso 5: Caso Real en Acci√≥n -->
        <div class="step-content" data-step="5">
            <div class="problem-section">
                <h2>üö® Factor de Correcci√≥n en Acci√≥n</h2>
                <p style="font-size: 1.2em;">Caso Real: Cuando el Modelo Base Subestima los Ingresos</p>
            </div>

            <div class="comparison-grid">
                <div class="value-card real-value">
                    <div>Valor Real</div>
                    <div class="value-amount">$4.875.338</div>
                    <div>exp(15,3897)</div>
                </div>
                <div class="value-card model-value">
                    <div>Modelo Base</div>
                    <div class="value-amount">$3.269.017</div>
                    <div>exp(15)</div>
                </div>
                <div class="value-card difference-value">
                    <div>Diferencia (P√©rdida)</div>
                    <div class="value-amount">$1.606.321</div>
                    <div>-32.9% Error</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="chart5"></canvas>
            </div>

            <div class="factor-section">
                <h3 style="text-align: center; margin-bottom: 30px;">üßÆ C√°lculo del Factor de Correcci√≥n</h3>
                
                <div class="factor-formula">
                    Factor = Valor_Real √∑ Predicci√≥n_Modelo_Base
                </div>
                
                <div class="factor-formula">
                    Factor = $4.875.338 √∑ $3.269.017 = <span style="color: #ffeaa7;">1.4914</span>
                </div>
                
                <div class="factor-result">
                    Factor = 1.49
                </div>
                
                <p style="text-align: center; font-size: 1.2em;">
                    Este GAD genera sistem√°ticamente <strong>49% m√°s ingresos</strong> que el comportamiento promedio
                </p>
            </div>

            <div class="steps-process">
                <div class="process-card">
                    <div class="process-number">1</div>
                    <h4>Identificar la Brecha</h4>
                    <p>El modelo base subestima consistentemente los ingresos de este GAD espec√≠fico por $1.6 millones.</p>
                </div>
                
                <div class="process-card">
                    <div class="process-number">2</div>
                    <h4>Calcular el Factor</h4>
                    <p>Factor = 1.49 indica que este GAD supera el comportamiento promedio en 49%.</p>
                </div>
                
                <div class="process-card">
                    <div class="process-number">3</div>
                    <h4>Aplicar Correcci√≥n</h4>
                    <p>Para futuras predicciones: Predicci√≥n_Base √ó 1.49 = Predicci√≥n_Corregida</p>
                </div>
            </div>

            <div class="solution-section">
                <h3>üí° La Soluci√≥n: Predicci√≥n Corregida</h3>
                <p style="font-size: 1.1em;">Para proyecciones futuras de este GAD:</p>
                
                <div class="factor-formula">
                    Predicci√≥n_Corregida = Predicci√≥n_Modelo_Base √ó 1.4914
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; margin: 25px 0;">
                    <h4>Ejemplo de Proyecci√≥n Futura:</h4>
                    <p><strong>Si el modelo base predice:</strong> $3.500.000</p>
                    <p><strong>Predicci√≥n corregida:</strong> $3.500.000 √ó 1.49 = <span style="color: #ffeaa7; font-size: 1.3em; font-weight: bold;">$5.219.900</span></p>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="animateRealCase()">üé¨ Mostrar Animaci√≥n</button>
                <button class="btn btn-secondary" onclick="resetRealCase()">üîÑ Reiniciar</button>
            </div>

            <div class="highlight-box">
                <h3>üéØ ¬øPor qu√© funciona este enfoque?</h3>
                <p><strong>Estabilidad:</strong> El modelo base proporciona una tendencia estable y confiable</p>
                <p><strong>Personalizaci√≥n:</strong> El factor ajusta esa tendencia a las caracter√≠sticas espec√≠ficas del GAD</p>
                <p><strong>Robustez:</strong> Combina la generalizaci√≥n del modelo base con la precisi√≥n local del factor</p>
            </div>

            <div class="interpretation-box">
                <h4>üìä Interpretaci√≥n del Factor 1.49</h4>
                <p>Este GAD tiene caracter√≠sticas que lo hacen <strong>sistem√°ticamente m√°s eficiente</strong> en la generaci√≥n de ingresos:</p>
                <ul>
                    <li>Mayor capacidad de recaudaci√≥n</li>
                    <li>Mejor gesti√≥n administrativa</li>
                    <li>Ubicaci√≥n estrat√©gica o caracter√≠sticas econ√≥micas favorables</li>
                    <li>Mayor cultura de pago ciudadana</li>
                </ul>
                <p><strong>Resultado:</strong> Sus ingresos reales superan consistentemente las predicciones del modelo promedio en aproximadamente 49%.</p>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-secondary" onclick="previousStep()" id="prevBtn" style="display: none;">‚¨ÖÔ∏è Anterior</button>
            <button class="btn btn-primary" onclick="nextStep()" id="nextBtn">Siguiente ‚û°Ô∏è</button>
            <button class="btn btn-secondary" onclick="resetDemo()">üîÑ Reiniciar Demo</button>
        </div>

        <div class="interpretation-box">
            <h4>üí° Resumen: ¬øPor qu√© dos modelos?</h4>
            <p><strong>Modelo Completo:</strong> Captura la realidad completa pero puede sobreajustar a caracter√≠sticas espec√≠ficas que pueden no persistir en el futuro.</p>
            <p><strong>Modelo Base:</strong> Proporciona una referencia estable y neutral que sirve como denominador com√∫n para todos los GADs.</p>
            <p><strong>Factor de Correcci√≥n:</strong> Permite personalizar las predicciones manteniendo la estabilidad del modelo base.</p>
        </div>
    </div>

    <script>
        // Variables globales
        let currentStep = 1;
        let charts = {};
        let currentGADType = 'urbano';
        
        // Datos simulados
        const years = [2018, 2019, 2020, 2021, 2022, 2023, 2024];
        const realCaseYears = ['2020', '2021', '2022', '2023', '2024', '2025', '2026'];
        
        const gadData = {
            urbano: {
                real: [100, 108, 95, 112, 125, 138, 142],
                base: [100, 105, 88, 108, 118, 128, 132],
                complete: [100, 107, 94, 111, 124, 137, 141],
                factor: 1.20,
                color: '#e74c3c',
                name: 'GAD Urbano'
            },
            rural: {
                real: [80, 82, 75, 85, 88, 92, 95],
                base: [100, 105, 88, 108, 118, 128, 132],
                complete: [80, 81, 74, 84, 87, 91, 94],
                factor: 0.85,
                color: '#27ae60',
                name: 'GAD Rural'
            },
            turistico: {
                real: [90, 95, 70, 110, 85, 125, 105],
                base: [100, 105, 88, 108, 118, 128, 132],
                complete: [90, 94, 69, 109, 84, 124, 104],
                factor: 1.05,
                color: '#3498db',
                name: 'GAD Tur√≠stico'
            }
        };

        // Datos del caso real
        const realCaseData = {
            realValues: [3800000, 4100000, 4450000, 4600000, 4875338, null, null],
            baseModel: [2800000, 3000000, 3150000, 3200000, 3269017, 3400000, 3550000],
            correctedModel: [null, null, null, null, null, 5069600, 5294050],
            originalCorrectedModel: [null, null, null, null, null, 5069600, 5294050]
        };

        // Inicializar gr√°ficos
        function initializeCharts() {
            // Gr√°fico 1: Datos hist√≥ricos
            const ctx1 = document.getElementById('chart1').getContext('2d');
            charts.chart1 = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'GAD Urbano',
                            data: gadData.urbano.real,
                            borderColor: gadData.urbano.color,
                            backgroundColor: gadData.urbano.color + '20',
                            tension: 0.4,
                            pointRadius: 6,
                            borderWidth: 3
                        },
                        {
                            label: 'GAD Rural',
                            data: gadData.rural.real,
                            borderColor: gadData.rural.color,
                            backgroundColor: gadData.rural.color + '20',
                            tension: 0.4,
                            pointRadius: 6,
                            borderWidth: 3
                        },
                        {
                            label: 'GAD Tur√≠stico',
                            data: gadData.turistico.real,
                            borderColor: gadData.turistico.color,
                            backgroundColor: gadData.turistico.color + '20',
                            tension: 0.4,
                            pointRadius: 6,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Datos Hist√≥ricos Reales de Ingresos por GAD',
                            font: { size: 18, weight: 'bold' }
                        },
                        legend: {
                            position: 'top',
                            labels: { padding: 20, font: { size: 12 } }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Ingresos (√≠ndice base 100)',
                                font: { size: 14, weight: 'bold' }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'A√±o',
                                font: { size: 14, weight: 'bold' }
                            }
                        }
                    }
                }
            });

            // Gr√°fico 2: Modelo completo
            const ctx2 = document.getElementById('chart2').getContext('2d');
            charts.chart2 = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Real - GAD Urbano',
                            data: gadData.urbano.real,
                            borderColor: gadData.urbano.color,
                            backgroundColor: 'transparent',
                            tension: 0.4,
                            pointRadius: 8,
                            borderWidth: 3
                        },
                        {
                            label: 'Predicci√≥n Completa - GAD Urbano',
                            data: gadData.urbano.complete,
                            borderColor: gadData.urbano.color,
                            backgroundColor: 'transparent',
                            borderDash: [8, 8],
                            tension: 0.4,
                            pointRadius: 6,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Modelo Completo: Ajuste Espec√≠fico por GAD',
                            font: { size: 18, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Ingresos (√≠ndice base 100)',
                                font: { size: 14, weight: 'bold' }
                            }
                        }
                    }
                }
            });

            // Gr√°fico 3: Modelo base
            const ctx3 = document.getElementById('chart3').getContext('2d');
            charts.chart3 = new Chart(ctx3, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Real - GAD Urbano',
                            data: gadData.urbano.real,
                            borderColor: gadData.urbano.color,
                            backgroundColor: 'transparent',
                            tension: 0.4,
                            pointRadius: 6,
                            borderWidth: 3
                        },
                        {
                            label: 'Real - GAD Rural',
                            data: gadData.rural.real,
                            borderColor: gadData.rural.color,
                            backgroundColor: 'transparent',
                            tension: 0.4,
                            pointRadius: 6,
                            borderWidth: 3
                        },
                        {
                            label: 'Predicci√≥n Base (Com√∫n)',
                            data: gadData.urbano.base,
                            borderColor: '#9b59b6',
                            backgroundColor: 'transparent',
                            borderDash: [10, 10],
                            tension: 0.4,
                            pointRadius: 8,
                            borderWidth: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Modelo Base: L√≠nea Neutral Com√∫n',
                            font: { size: 18, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Ingresos (√≠ndice base 100)',
                                font: { size: 14, weight: 'bold' }
                            }
                        }
                    }
                }
            });

            // Gr√°fico 4: Factor de correcci√≥n
            const ctx4 = document.getElementById('chart4').getContext('2d');
            charts.chart4 = new Chart(ctx4, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Factor de Correcci√≥n por GAD',
                            font: { size: 18, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Ingresos (√≠ndice base 100)',
                                font: { size: 14, weight: 'bold' }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Factor de Correcci√≥n',
                                font: { size: 14, weight: 'bold' }
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });

            // Gr√°fico 5: Caso real
            const ctx5 = document.getElementById('chart5').getContext('2d');
            charts.chart5 = new Chart(ctx5, {
                type: 'line',
                data: {
                    labels: realCaseYears,
                    datasets: [
                        {
                            label: 'Valores Reales (Hist√≥rico)',
                            data: realCaseData.realValues,
                            borderColor: '#27ae60',
                            backgroundColor: '#27ae60',
                            pointBackgroundColor: '#27ae60',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 3,
                            pointRadius: 8,
                            tension: 0.4,
                            borderWidth: 4
                        },
                        {
                            label: 'Modelo Base (Predicci√≥n Neutral)',
                            data: realCaseData.baseModel,
                            borderColor: '#e74c3c',
                            backgroundColor: 'transparent',
                            pointBackgroundColor: '#e74c3c',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            tension: 0.4,
                            borderWidth: 3,
                            borderDash: [10, 5]
                        },
                        {
                            label: 'Predicci√≥n Corregida (Base √ó 1.49)',
                            data: realCaseData.correctedModel,
                            borderColor: '#6c5ce7',
                            backgroundColor: '#6c5ce7',
                            pointBackgroundColor: '#6c5ce7',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 3,
                            pointRadius: 10,
                            tension: 0.4,
                            borderWidth: 4,
                            pointStyle: 'rectRot'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Caso Real: Evoluci√≥n Temporal con Factor de Correcci√≥n',
                            font: { size: 18, weight: 'bold' }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: { size: 12, weight: 'bold' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: '#667eea',
                            borderWidth: 2,
                            callbacks: {
                                label: function(context) {
                                    let value = context.parsed.y;
                                    if (value) {
                                        return context.dataset.label + ':  + value.toLocaleString();
                                    }
                                    return null;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 2500000,
                            title: {
                                display: true,
                                text: 'Ingresos (USD)',
                                font: { size: 14, weight: 'bold' }
                            },
                            ticks: {
                                callback: function(value) {
                                    return ' + (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'A√±o',
                                font: { size: 14, weight: 'bold' }
                            }
                        }
                    }
                }
            });

            // Inicializar GAD urbano por defecto
            selectGAD('urbano');
        }

        // Seleccionar tipo de GAD
        function selectGAD(gadType) {
            currentGADType = gadType;
            const data = gadData[gadType];
            
            // Actualizar botones
            document.querySelectorAll('.gad-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Actualizar displays
            document.getElementById('factorDisplay').textContent = data.factor.toFixed(2);
            document.getElementById('gadNameDisplay').textContent = data.name;
            const percentage = ((data.factor - 1) * 100).toFixed(0);
            document.getElementById('percentageDisplay').textContent = (percentage >= 0 ? '+' : '') + percentage + '%';
            
            // Calcular factores de correcci√≥n
            const factors = data.real.map((real, i) => real / data.base[i]);
            
            // Actualizar gr√°fico
            charts.chart4.data.datasets = [
                {
                    label: 'Valor Real',
                    data: data.real,
                    borderColor: data.color,
                    backgroundColor: 'transparent',
                    tension: 0.4,
                    pointRadius: 6,
                    borderWidth: 3,
                    yAxisID: 'y'
                },
                {
                    label: 'Predicci√≥n Base',
                    data: data.base,
                    borderColor: '#9b59b6',
                    backgroundColor: 'transparent',
                    borderDash: [8, 8],
                    tension: 0.4,
                    pointRadius: 6,
                    borderWidth: 3,
                    yAxisID: 'y'
                },
                {
                    label: 'Factor de Correcci√≥n',
                    data: factors,
                    borderColor: '#f39c12',
                    backgroundColor: '#f39c12' + '30',
                    tension: 0.4,
                    pointRadius: 8,
                    borderWidth: 3,
                    fill: true,
                    yAxisID: 'y1'
                }
            ];
            
            charts.chart4.update();
        }

        // Animar caso real
        function animateRealCase() {
            // Reiniciar datos
            charts.chart5.data.datasets[2].data = [null, null, null, null, null, null, null];
            charts.chart5.update('none');
            
            // Animar aparici√≥n
            setTimeout(() => {
                charts.chart5.data.datasets[2].data[5] = 5069600;
                charts.chart5.update('active');
            }, 500);
            
            setTimeout(() => {
                charts.chart5.data.datasets[2].data[6] = 5294050;
                charts.chart5.update('active');
            }, 1000);
            
            // Resaltar punto 2024
            setTimeout(() => {
                charts.chart5.data.datasets[0].pointRadius = [6, 6, 6, 6, 15, 6, 6];
                charts.chart5.data.datasets[1].pointRadius = [6, 6, 6, 6, 15, 6, 6];
                charts.chart5.update('active');
            }, 1500);
        }

        // Reiniciar caso real
        function resetRealCase() {
            charts.chart5.data.datasets[2].data = [...realCaseData.originalCorrectedModel];
            charts.chart5.data.datasets[0].pointRadius = 8;
            charts.chart5.data.datasets[1].pointRadius = 6;
            charts.chart5.update();
        }

        // Navegaci√≥n entre pasos
        function nextStep() {
            if (currentStep < 5) {
                // Ocultar paso actual
                document.querySelector(`[data-step="${currentStep}"].step-content`).classList.remove('active');
                document.querySelector(`[data-step="${currentStep}"].step-dot`).classList.remove('active');
                document.querySelector(`[data-step="${currentStep}"].step-dot`).classList.add('completed');
                
                // Mostrar siguiente paso
                currentStep++;
                document.querySelector(`[data-step="${currentStep}"].step-content`).classList.add('active');
                document.querySelector(`[data-step="${currentStep}"].step-dot`).classList.add('active');
                
                // Actualizar botones
                document.getElementById('prevBtn').style.display = 'inline-block';
                if (currentStep === 5) {
                    document.getElementById('nextBtn').textContent = '‚úÖ Completado';
                    document.getElementById('nextBtn').disabled = true;
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                // Ocultar paso actual
                document.querySelector(`[data-step="${currentStep}"].step-content`).classList.remove('active');
                document.querySelector(`[data-step="${currentStep}"].step-dot`).classList.remove('active');
                
                // Mostrar paso anterior
                currentStep--;
                document.querySelector(`[data-step="${currentStep}"].step-content`).classList.add('active');
                document.querySelector(`[data-step="${currentStep}"].step-dot`).classList.remove('completed');
                document.querySelector(`[data-step="${currentStep}"].step-dot`).classList.add('active');
                
                // Actualizar botones
                if (currentStep === 1) {
                    document.getElementById('prevBtn').style.display = 'none';
                }
                document.getElementById('nextBtn').textContent = 'Siguiente ‚û°Ô∏è';
                document.getElementById('nextBtn').disabled = false;
            }
        }

        function resetDemo() {
            // Reiniciar a paso 1
            document.querySelectorAll('.step-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.step-dot').forEach(dot => {
                dot.classList.remove('active', 'completed');
            });
            
            currentStep = 1;
            document.querySelector('[data-step="1"].step-content').classList.add('active');
            document.querySelector('[data-step="1"].step-dot').classList.add('completed');
            
            document.getElementById('prevBtn').style.display = 'none';
            document.getElementById('nextBtn').textContent = 'Siguiente ‚û°Ô∏è';
            document.getElementById('nextBtn').disabled = false;
            
            // Reiniciar caso real
            resetRealCase();
        }

        // Inicializar cuando se carga la p√°gina
        window.addEventListener('load', function() {
            initializeCharts();
        });
    </script>
</body>
</html>
